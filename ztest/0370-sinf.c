#include <stdio.h>
#include <float.h>
#include <math.h>
#include "my_printf.c"

#define TOLERANCE 1e-6f
#define PI_F 3.1415927f

// Precomputed coefficients for Taylor expansion (float)
#define SIN_C3  -0.16666667f      // -1/6
#define SIN_C5   0.0083333333f    //  1/120
#define SIN_C7  -0.00019841270f   // -1/5040
#define SIN_C9   0.00000275573f   //  1/362880

#define COS_C2  -0.5f             // -1/2
#define COS_C4   0.041666667f     //  1/24
#define COS_C6  -0.0013888889f    // -1/720
#define COS_C8   0.000024801587f  //  1/40320

float minimax_sinf(float x) {
    if (fabsf(x) < 0.0001f) return x; // ニアゼロ近似
    float x2 = x * x;
    return x * (1.0f + x2 * (-0.1666666667f +
           x2 * (0.0083333333f +
           x2 * (-0.0001984127f +
           x2 * (2.7557319e-06f +
           x2 * -2.5050759e-08f)))));
}
float minimax_cosf(float x) {
    float x2 = x * x;
    return 1.0f
         + x2 * (-0.5f
         + x2 * (0.041666641f
         + x2 * (-0.0013888377f
         + x2 * (2.4801587e-05f
         + x2 * -2.7557319e-07f))));
}

float mysinf(float x)
{
  x = fmodf(x + M_PI,  M_TWOPI) - M_PI;
  if (fabsf(x) < 0.001f) return x;

  float n_f = roundf(x / M_PI_2);
  int n = (int)n_f;
  float y = x - n_f * M_PI_2;

    switch (n & 3) {
        case 0: // 0〜π/2
           return minimax_sinf(y);
        case 1: // π/2〜π
            return minimax_cosf(y);
        case 2: // π〜3π/2
            return  -minimax_sinf(y);
        case 3: // 3π/2〜2π
            return -minimax_cosf(y);
    }
}


float mycosf(float x)
{
    if (fabsf(x) < 0.001f) return 1.0f;

    x = fmodf(x, M_TWOPI);
    if (x > M_PI) x -= M_TWOPI;
    if (x < -M_PI) x += M_TWOPI;

    int n = (int)roundf(x / M_PI_2);
    float y = x - n * M_PI_2;

    float result = minimax_cosf(y);

    switch (n & 3) {
        case 0: return result;
        case 1: return -minimax_sinf(y);
        case 2: return -result;
        case 3: return minimax_sinf(y);
        default: return 0.0f;
    }
}





// Test cases: multiples of pi/8 and their neighbors, and special values
// (This is just a partial list. Paste the full auto-generated array here.)

typedef struct {
    float input;
    float expected;
} SinTestCase;

const SinTestCase test_cases[] = {
    { -12.5763706f, -0.0099998f },
    { -12.5663706f, 0.0000000f },
    { -12.5563706f, 0.0099998f },
    { -12.1836715f, 0.3734257f },
    { -12.1736715f, 0.3826834f },
    { -12.1636715f, 0.3919029f },
    { -11.7909725f, 0.7000005f },
    { -11.7809725f, 0.7071068f },
    { -11.7709725f, 0.7141424f },
    { -11.3982734f, 0.9200066f },
    { -11.3882734f, 0.9238795f },
    { -11.3782734f, 0.9276601f },
    { -11.0055743f, 0.9999500f },
    { -10.9955743f, 1.0000000f },
    { -10.9855743f, 0.9999500f },
    { -10.6128752f, 0.9276601f },
    { -10.6028752f, 0.9238795f },
    { -10.5928752f, 0.9200066f },
    { -10.2201761f, 0.7141424f },
    { -10.2101761f, 0.7071068f },
    { -10.2001761f, 0.7000005f },
    { -9.8274770f, 0.3919029f },
    { -9.8174770f, 0.3826834f },
    { -9.8074770f, 0.3734257f },
    { -9.4347780f, 0.0099998f },
    { -9.4247780f, -0.0000000f },
    { -9.4147780f, -0.0099998f },
    { -9.0420789f, -0.3734257f },
    { -9.0320789f, -0.3826834f },
    { -9.0220789f, -0.3919029f },
    { -8.6493798f, -0.7000005f },
    { -8.6393798f, -0.7071068f },
    { -8.6293798f, -0.7141424f },
    { -8.2566807f, -0.9200066f },
    { -8.2466807f, -0.9238795f },
    { -8.2366807f, -0.9276601f },
    { -7.8639816f, -0.9999500f },
    { -7.8539816f, -1.0000000f },
    { -7.8439816f, -0.9999500f },
    { -7.4712826f, -0.9276601f },
    { -7.4612826f, -0.9238795f },
    { -7.4512826f, -0.9200066f },
    { -7.0785835f, -0.7141424f },
    { -7.0685835f, -0.7071068f },
    { -7.0585835f, -0.7000005f },
    { -6.6858844f, -0.3919029f },
    { -6.6758844f, -0.3826834f },
    { -6.6658844f, -0.3734257f },
    { -6.2931853f, -0.0099998f },
    { -6.2831853f, 0.0000000f },
    { -6.2731853f, 0.0099998f },
    { -5.9004862f, 0.3734257f },
    { -5.8904862f, 0.3826834f },
    { -5.8804862f, 0.3919029f },
    { -5.5077871f, 0.7000005f },
    { -5.4977871f, 0.7071068f },
    { -5.4877871f, 0.7141424f },
    { -5.1150881f, 0.9200066f },
    { -5.1050881f, 0.9238795f },
    { -5.0950881f, 0.9276601f },
    { -4.7223890f, 0.9999500f },
    { -4.7123890f, 1.0000000f },
    { -4.7023890f, 0.9999500f },
    { -4.3296899f, 0.9276601f },
    { -4.3196899f, 0.9238795f },
    { -4.3096899f, 0.9200066f },
    { -3.9369908f, 0.7141424f },
    { -3.9269908f, 0.7071068f },
    { -3.9169908f, 0.7000005f },
    { -3.5442917f, 0.3919029f },
    { -3.5342917f, 0.3826834f },
    { -3.5242917f, 0.3734257f },
    { -3.1515927f, 0.0099998f },
    { -3.1415927f, -0.0000000f },
    { -3.1315927f, -0.0099998f },
    { -2.7588936f, -0.3734257f },
    { -2.7488936f, -0.3826834f },
    { -2.7388936f, -0.3919029f },
    { -2.3661945f, -0.7000005f },
    { -2.3561945f, -0.7071068f },
    { -2.3461945f, -0.7141424f },
    { -1.9734954f, -0.9200066f },
    { -1.9634954f, -0.9238795f },
    { -1.9534954f, -0.9276601f },
    { -1.5807963f, -0.9999500f },
    { -1.5707963f, -1.0000000f },
    { -1.5607963f, -0.9999500f },
    { -1.1880972f, -0.9276601f },
    { -1.1780972f, -0.9238795f },
    { -1.1680972f, -0.9200066f },
    { -0.7953982f, -0.7141424f },
    { -0.7853982f, -0.7071068f },
    { -0.7753982f, -0.7000005f },
    { -0.4026991f, -0.3919029f },
    { -0.3926991f, -0.3826834f },
    { -0.3826991f, -0.3734257f },
    { -0.0100000f, -0.0099998f },
    { 0.0000000f, 0.0000000f },
    { 0.0100000f, 0.0099998f },
    { 0.3826991f, 0.3734257f },
    { 0.3926991f, 0.3826834f },
    { 0.4026991f, 0.3919029f },
    { 0.7753982f, 0.7000005f },
    { 0.7853982f, 0.7071068f },
    { 0.7953982f, 0.7141424f },
    { 1.1680972f, 0.9200066f },
    { 1.1780972f, 0.9238795f },
    { 1.1880972f, 0.9276601f },
    { 1.5607963f, 0.9999500f },
    { 1.5707963f, 1.0000000f },
    { 1.5807963f, 0.9999500f },
    { 1.9534954f, 0.9276601f },
    { 1.9634954f, 0.9238795f },
    { 1.9734954f, 0.9200066f },
    { 2.3461945f, 0.7141424f },
    { 2.3561945f, 0.7071068f },
    { 2.3661945f, 0.7000005f },
    { 2.7388936f, 0.3919029f },
    { 2.7488936f, 0.3826834f },
    { 2.7588936f, 0.3734257f },
    { 3.1315927f, 0.0099998f },
    { 3.1415927f, 0.0000000f },
    { 3.1515927f, -0.0099998f },
    { 3.5242917f, -0.3734257f },
    { 3.5342917f, -0.3826834f },
    { 3.5442917f, -0.3919029f },
    { 3.9169908f, -0.7000005f },
    { 3.9269908f, -0.7071068f },
    { 3.9369908f, -0.7141424f },
    { 4.3096899f, -0.9200066f },
    { 4.3196899f, -0.9238795f },
    { 4.3296899f, -0.9276601f },
    { 4.7023890f, -0.9999500f },
    { 4.7123890f, -1.0000000f },
    { 4.7223890f, -0.9999500f },
    { 5.0950881f, -0.9276601f },
    { 5.1050881f, -0.9238795f },
    { 5.1150881f, -0.9200066f },
    { 5.4877871f, -0.7141424f },
    { 5.4977871f, -0.7071068f },
    { 5.5077871f, -0.7000005f },
    { 5.8804862f, -0.3919029f },
    { 5.8904862f, -0.3826834f },
    { 5.9004862f, -0.3734257f },
    { 6.2731853f, -0.0099998f },
    { 6.2831853f, -0.0000000f },
    { 6.2931853f, 0.0099998f },
    { 6.6658844f, 0.3734257f },
    { 6.6758844f, 0.3826834f },
    { 6.6858844f, 0.3919029f },
    { 7.0585835f, 0.7000005f },
    { 7.0685835f, 0.7071068f },
    { 7.0785835f, 0.7141424f },
    { 7.4512826f, 0.9200066f },
    { 7.4612826f, 0.9238795f },
    { 7.4712826f, 0.9276601f },
    { 7.8439816f, 0.9999500f },
    { 7.8539816f, 1.0000000f },
    { 7.8639816f, 0.9999500f },
    { 8.2366807f, 0.9276601f },
    { 8.2466807f, 0.9238795f },
    { 8.2566807f, 0.9200066f },
    { 8.6293798f, 0.7141424f },
    { 8.6393798f, 0.7071068f },
    { 8.6493798f, 0.7000005f },
    { 9.0220789f, 0.3919029f },
    { 9.0320789f, 0.3826834f },
    { 9.0420789f, 0.3734257f },
    { 9.4147780f, 0.0099998f },
    { 9.4247780f, 0.0000000f },
    { 9.4347780f, -0.0099998f },
    { 9.8074770f, -0.3734257f },
    { 9.8174770f, -0.3826834f },
    { 9.8274770f, -0.3919029f },
    { 10.2001761f, -0.7000005f },
    { 10.2101761f, -0.7071068f },
    { 10.2201761f, -0.7141424f },
    { 10.5928752f, -0.9200066f },
    { 10.6028752f, -0.9238795f },
    { 10.6128752f, -0.9276601f },
    { 10.9855743f, -0.9999500f },
    { 10.9955743f, -1.0000000f },
    { 11.0055743f, -0.9999500f },
    { 11.3782734f, -0.9276601f },
    { 11.3882734f, -0.9238795f },
    { 11.3982734f, -0.9200066f },
    { 11.7709725f, -0.7141424f },
    { 11.7809725f, -0.7071068f },
    { 11.7909725f, -0.7000005f },
    { 12.1636715f, -0.3919029f },
    { 12.1736715f, -0.3826834f },
    { 12.1836715f, -0.3734257f },
    { 12.5563706f, -0.0099998f },
    { 12.5663706f, -0.0000000f },
    { 12.5763706f, 0.0099998f },
    { 0.0000000f, 0.0000000f },
    { -0.0000000f, 0.0000000f },
};
#define NUM_TESTS (sizeof(test_cases)/sizeof(test_cases[0]))

// Test one case and print the result
void test_sin(const SinTestCase* tc) {
//    float actual = mysinf(tc->input);
    float actual = sinf(tc->input);
    float diff   = actual - tc->expected;
    if (diff < 0) diff = -diff;

    printf("x: %.7f, y: %.7f, expected: %.7f, diff: %.7f\n",
           tc->input, actual, tc->expected, diff);
}

int main(void) {
    // Loop through all test cases
    for (int i = 0; i < NUM_TESTS; ++i) {
        test_sin(&test_cases[i]);
    }
    return 0;
}
