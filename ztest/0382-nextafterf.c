#include <stdio.h>
#include <stdint.h>
#include <math.h>
#include <string.h>

#include "my_printf.c"

typedef struct { float a, b, expect; } testcase_t;
const testcase_t testcases[] = {
    {0x0.0p+0, 0x0.0p+0, 0x0.0p+0},
    {0x0.0p+0, -0x0.0p+0, -0x0.0p+0},
    {-0x0.0p+0, 0x0.0p+0, 0x0.0p+0},
    {-0x0.0p+0, -0x0.0p+0, -0x0.0p+0},
    {0x0.0p+0, 0x1.0000000000000p-149, 0x1.0000000000000p-149},
    {0x0.0p+0, -0x1.0000000000000p-149, -0x1.0000000000000p-149},
    {0x1.0000000000000p-149, 0x0.0p+0, 0x0.0p+0},
    {-0x1.0000000000000p-149, 0x0.0p+0, -0x0.0p+0},
    {0x1.fffffc0000000p-127, 0x0.0p+0, 0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, 0x0.0p+0, -0x1.fffff80000000p-127},
    {0x1.fffffe0000000p+127, INFINITY, INFINITY},
    {-0x1.fffffe0000000p+127, -INFINITY, -INFINITY},
    {INFINITY, 0x0.0p+0, 0x1.fffffe0000000p+127},
    {-INFINITY, 0x0.0p+0, -0x1.fffffe0000000p+127},
    {INFINITY, INFINITY, INFINITY},
    {-INFINITY, -INFINITY, -INFINITY},
    {INFINITY, -INFINITY, 0x1.fffffe0000000p+127},
    {-INFINITY, INFINITY, -0x1.fffffe0000000p+127},
    {NAN, 0x1.0000000000000p+0, NAN},
    {0x1.0000000000000p+0, NAN, NAN},
    {NAN, NAN, NAN},
    {0x1.0000000000000p+0, 0x1.0000000000000p+1, 0x1.0000020000000p+0},
    {0x1.0000000000000p+0, 0x0.0p+0, 0x1.fffffe0000000p-1},
    {-0x1.0000000000000p+0, -0x1.0000000000000p+1, -0x1.0000020000000p+0},
    {-0x1.0000000000000p+0, 0x0.0p+0, -0x1.fffffe0000000p-1},
    {0x1.0000000000000p+0, -0x1.0000000000000p+0, 0x1.fffffe0000000p-1},
    {-0x1.0000000000000p+0, 0x1.0000000000000p+0, -0x1.fffffe0000000p-1},
    {0x1.0000000000000p+0, 0x1.0000000000000p+0, 0x1.0000000000000p+0},
    {-0x1.0000000000000p+0, -0x1.0000000000000p+0, -0x1.0000000000000p+0},
    {0x1.0000000000000p-149, 0x1.fffffc0000000p-127, 0x1.0000000000000p-148},
    {-0x1.0000000000000p-149, -0x1.fffffc0000000p-127, -0x1.0000000000000p-148},
    {0x1.fffffc0000000p-127, 0x1.0000000000000p-149, 0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, -0x1.0000000000000p-149, -0x1.fffff80000000p-127},
    {0x1.fffffe0000000p+127, 0x0.0p+0, 0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, 0x0.0p+0, -0x1.fffffc0000000p+127},
    {0x0.0p+0, 0x1.fffffe0000000p+127, 0x1.0000000000000p-149},
    {0x0.0p+0, -0x1.fffffe0000000p+127, -0x1.0000000000000p-149},
    {0x0.0p+0, 0x0.0p+0, 0x0.0p+0},
    {0x0.0p+0, -0x0.0p+0, -0x0.0p+0},
    {0x0.0p+0, 0x1.0000000000000p-149, 0x1.0000000000000p-149},
    {0x0.0p+0, -0x1.0000000000000p-149, -0x1.0000000000000p-149},
    {0x0.0p+0, 0x1.fffffc0000000p-127, 0x1.0000000000000p-149},
    {0x0.0p+0, -0x1.fffffc0000000p-127, -0x1.0000000000000p-149},
    {0x0.0p+0, 0x1.fffffe0000000p+127, 0x1.0000000000000p-149},
    {0x0.0p+0, -0x1.fffffe0000000p+127, -0x1.0000000000000p-149},
    {-0x0.0p+0, 0x0.0p+0, 0x0.0p+0},
    {-0x0.0p+0, -0x0.0p+0, -0x0.0p+0},
    {-0x0.0p+0, 0x1.0000000000000p-149, 0x1.0000000000000p-149},
    {-0x0.0p+0, -0x1.0000000000000p-149, -0x1.0000000000000p-149},
    {-0x0.0p+0, 0x1.fffffc0000000p-127, 0x1.0000000000000p-149},
    {-0x0.0p+0, -0x1.fffffc0000000p-127, -0x1.0000000000000p-149},
    {-0x0.0p+0, 0x1.fffffe0000000p+127, 0x1.0000000000000p-149},
    {-0x0.0p+0, -0x1.fffffe0000000p+127, -0x1.0000000000000p-149},
    {0x1.0000000000000p-149, 0x0.0p+0, 0x0.0p+0},
    {0x1.0000000000000p-149, -0x0.0p+0, 0x0.0p+0},
    {0x1.0000000000000p-149, 0x1.0000000000000p-149, 0x1.0000000000000p-149},
    {0x1.0000000000000p-149, -0x1.0000000000000p-149, 0x0.0p+0},
    {0x1.0000000000000p-149, 0x1.fffffc0000000p-127, 0x1.0000000000000p-148},
    {0x1.0000000000000p-149, -0x1.fffffc0000000p-127, 0x0.0p+0},
    {0x1.0000000000000p-149, 0x1.fffffe0000000p+127, 0x1.0000000000000p-148},
    {0x1.0000000000000p-149, -0x1.fffffe0000000p+127, 0x0.0p+0},
    {-0x1.0000000000000p-149, 0x0.0p+0, -0x0.0p+0},
    {-0x1.0000000000000p-149, -0x0.0p+0, -0x0.0p+0},
    {-0x1.0000000000000p-149, 0x1.0000000000000p-149, -0x0.0p+0},
    {-0x1.0000000000000p-149, -0x1.0000000000000p-149, -0x1.0000000000000p-149},
    {-0x1.0000000000000p-149, 0x1.fffffc0000000p-127, -0x0.0p+0},
    {-0x1.0000000000000p-149, -0x1.fffffc0000000p-127, -0x1.0000000000000p-148},
    {-0x1.0000000000000p-149, 0x1.fffffe0000000p+127, -0x0.0p+0},
    {-0x1.0000000000000p-149, -0x1.fffffe0000000p+127, -0x1.0000000000000p-148},
    {0x1.fffffc0000000p-127, 0x0.0p+0, 0x1.fffff80000000p-127},
    {0x1.fffffc0000000p-127, -0x0.0p+0, 0x1.fffff80000000p-127},
    {0x1.fffffc0000000p-127, 0x1.0000000000000p-149, 0x1.fffff80000000p-127},
    {0x1.fffffc0000000p-127, -0x1.0000000000000p-149, 0x1.fffff80000000p-127},
    {0x1.fffffc0000000p-127, 0x1.fffffc0000000p-127, 0x1.fffffc0000000p-127},
    {0x1.fffffc0000000p-127, -0x1.fffffc0000000p-127, 0x1.fffff80000000p-127},
    {0x1.fffffc0000000p-127, 0x1.fffffe0000000p+127, 0x1.0000000000000p-126},
    {0x1.fffffc0000000p-127, -0x1.fffffe0000000p+127, 0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, 0x0.0p+0, -0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, -0x0.0p+0, -0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, 0x1.0000000000000p-149, -0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, -0x1.0000000000000p-149, -0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, 0x1.fffffc0000000p-127, -0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, -0x1.fffffc0000000p-127, -0x1.fffffc0000000p-127},
    {-0x1.fffffc0000000p-127, 0x1.fffffe0000000p+127, -0x1.fffff80000000p-127},
    {-0x1.fffffc0000000p-127, -0x1.fffffe0000000p+127, -0x1.0000000000000p-126},
    {0x1.fffffe0000000p+127, 0x0.0p+0, 0x1.fffffc0000000p+127},
    {0x1.fffffe0000000p+127, -0x0.0p+0, 0x1.fffffc0000000p+127},
    {0x1.fffffe0000000p+127, 0x1.0000000000000p-149, 0x1.fffffc0000000p+127},
    {0x1.fffffe0000000p+127, -0x1.0000000000000p-149, 0x1.fffffc0000000p+127},
    {0x1.fffffe0000000p+127, 0x1.fffffc0000000p-127, 0x1.fffffc0000000p+127},
    {0x1.fffffe0000000p+127, -0x1.fffffc0000000p-127, 0x1.fffffc0000000p+127},
    {0x1.fffffe0000000p+127, 0x1.fffffe0000000p+127, 0x1.fffffe0000000p+127},
    {0x1.fffffe0000000p+127, -0x1.fffffe0000000p+127, 0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, 0x0.0p+0, -0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, -0x0.0p+0, -0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, 0x1.0000000000000p-149, -0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, -0x1.0000000000000p-149, -0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, 0x1.fffffc0000000p-127, -0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, -0x1.fffffc0000000p-127, -0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, 0x1.fffffe0000000p+127, -0x1.fffffc0000000p+127},
    {-0x1.fffffe0000000p+127, -0x1.fffffe0000000p+127, -0x1.fffffe0000000p+127},
    {0x1.2231a20000000p+19, 0x1.538fee0000000p-109, 0x1.2231a00000000p+19},
    {0x1.c9adba0000000p+103, -0x1.b5d3b40000000p-16, 0x1.c9adb80000000p+103},
    {0x1.75d7720000000p+78, NAN, NAN},
    {0x1.24f17c0000000p+110, 0x1.9a95ec0000000p-5, 0x1.24f17a0000000p+110},
    {0x1.b7b3140000000p+35, -0x1.a92da20000000p-26, 0x1.b7b3120000000p+35},
    {-0x1.d0882a0000000p-83, -0x1.303c3e0000000p-64, -0x1.d0882c0000000p-83},
    {0x1.874a4c0000000p+36, 0x1.740e060000000p-98, 0x1.874a4a0000000p+36},
    {-0x1.d87d280000000p-124, 0x1.33f6b80000000p+77, -0x1.d87d260000000p-124},
    {-0x1.1567be0000000p-87, -0x1.e42d720000000p-97, -0x1.1567bc0000000p-87},
    {0x1.25436c0000000p+98, 0x1.1cf51c0000000p+53, 0x1.25436a0000000p+98},
    {0x1.b6ccde0000000p+35, 0x1.316af80000000p-112, 0x1.b6ccdc0000000p+35},
    {-0x1.67be4c0000000p-63, 0x1.19cfb60000000p+25, -0x1.67be4a0000000p-63},
    {-0x1.a3f10e0000000p-108, -0x1.a8db620000000p-23, -0x1.a3f1100000000p-108},
    {-0x1.82d07a0000000p+96, 0x1.9957060000000p-92, -0x1.82d0780000000p+96},
    {0x1.6960920000000p-126, NAN, NAN},
    {0x1.8651ec0000000p+33, -0x1.18bab20000000p+10, 0x1.8651ea0000000p+33},
    {-0x1.d6ce900000000p+20, -0x1.fc4f360000000p+81, -0x1.d6ce920000000p+20},
    {0x1.32ef360000000p-55, 0x1.89a4c80000000p+78, 0x1.32ef380000000p-55},
    {0x1.37823a0000000p+99, -0x1.78a0860000000p+7, 0x1.3782380000000p+99},
    {0x1.2dd4a60000000p-105, 0x1.7889a80000000p-93, 0x1.2dd4a80000000p-105},
    {0x1.7583980000000p-127, -0x1.0d02860000000p+103, 0x1.7583940000000p-127},
    {-0x1.9f71c00000000p+53, -0x1.7d9b780000000p-49, -0x1.9f71be0000000p+53},
    {-0x1.32d9c60000000p-6, -0x1.9fef6a0000000p+123, -0x1.32d9c80000000p-6},
    {-0x1.f129fe0000000p-4, -0x1.12959c0000000p-12, -0x1.f129fc0000000p-4},
    {0x1.2c87740000000p+16, -0x1.93c4380000000p+88, 0x1.2c87720000000p+16},
    {0x1.97a9860000000p+6, 0x1.848d8a0000000p-67, 0x1.97a9840000000p+6},
    {-0x1.4928200000000p-68, -0x1.d0b93c0000000p+23, -0x1.4928220000000p-68},
    {-0x1.a2e6c80000000p-39, 0x1.4599700000000p+115, -0x1.a2e6c60000000p-39},
    {-0x1.5ed3f20000000p-120, 0x1.acc7b20000000p-9, -0x1.5ed3f00000000p-120},
    {-0x1.58a95e0000000p+37, 0x1.df2b860000000p+113, -0x1.58a95c0000000p+37},
    {0x1.207b9e0000000p+6, 0x1.5ed5ea0000000p+92, 0x1.207ba00000000p+6},
    {-0x1.a358e40000000p+71, -0x1.54c37a0000000p+71, -0x1.a358e20000000p+71},
    {-0x1.4a4a5e0000000p-105, 0x1.c88aae0000000p+43, -0x1.4a4a5c0000000p-105},
    {0x1.6d3c660000000p+13, -0x1.e7bff60000000p-90, 0x1.6d3c640000000p+13},
    {0x1.f48fa20000000p-72, -0x1.c2f16a0000000p-15, 0x1.f48fa00000000p-72},
    {-0x1.78f6b80000000p-93, 0x1.17f4ec0000000p-23, -0x1.78f6b60000000p-93},
    {-0x1.20fdc80000000p-18, -0x1.c53bd00000000p-55, -0x1.20fdc60000000p-18},
    {-0x1.2428120000000p+108, -0x1.a57c2c0000000p+112, -0x1.2428140000000p+108},
    {-0x1.0d13760000000p+11, 0x1.6409160000000p-27, -0x1.0d13740000000p+11},
    {-0x1.8878400000000p+25, -0x1.6720a60000000p-50, -0x1.88783e0000000p+25},
    {0x1.86180c0000000p-112, 0x1.9263080000000p-91, 0x1.86180e0000000p-112},
    {-0x1.490d720000000p+62, 0x1.ffafc20000000p-27, -0x1.490d700000000p+62},
    {-0x1.7db8060000000p+67, NAN, NAN},
    {0x1.fdd5500000000p+87, 0x1.45cfea0000000p+74, 0x1.fdd54e0000000p+87},
    {-0x1.a2c6c60000000p-13, 0x1.0a33fa0000000p-76, -0x1.a2c6c40000000p-13},
    {-0x1.a0aa3e0000000p-33, 0x1.3efce60000000p+71, -0x1.a0aa3c0000000p-33},
    {-0x1.191f1c0000000p-110, NAN, NAN},
    {0x1.9171fc0000000p+12, -0x1.e1d9580000000p+99, 0x1.9171fa0000000p+12},
    {0x1.2940be0000000p+34, 0x1.50d6fa0000000p-46, 0x1.2940bc0000000p+34},
    {0x1.1a45060000000p-11, 0x1.9972500000000p+118, 0x1.1a45080000000p-11},
    {-0x1.48fb420000000p-2, -0x1.0f4bd40000000p+30, -0x1.48fb440000000p-2},
    {-0x1.d946720000000p+61, -0x1.3c11de0000000p+32, -0x1.d946700000000p+61},
    {0x1.9253060000000p-40, -0x1.62fb620000000p-100, 0x1.9253040000000p-40},
    {0x1.4530bc0000000p-125, -0x1.fce9ee0000000p+58, 0x1.4530ba0000000p-125},
    {0x1.5b5ce80000000p+21, 0x1.760d4c0000000p-125, 0x1.5b5ce60000000p+21},
    {0x1.f214fe0000000p+86, -0x1.0c7c300000000p+8, 0x1.f214fc0000000p+86},
    {0x1.98ce520000000p+45, -0x1.018f260000000p+52, 0x1.98ce500000000p+45},
    {0x1.17c14e0000000p-106, -0x1.aa84480000000p+38, 0x1.17c14c0000000p-106},
    {0x1.e5e4060000000p+26, 0x1.55f7000000000p-9, 0x1.e5e4040000000p+26},
    {-0x1.9849740000000p-53, 0x1.7b8bbe0000000p-75, -0x1.9849720000000p-53},
    {0x1.5149400000000p-83, -0x1.cc25860000000p-40, 0x1.51493e0000000p-83},
    {0x1.4edcba0000000p-25, -0x1.c89ae40000000p-51, 0x1.4edcb80000000p-25},
    {-0x1.e167fc0000000p+66, 0x1.8ae8c00000000p-110, -0x1.e167fa0000000p+66},
    {0x1.bd496a0000000p-107, -0x1.e8c75c0000000p-80, 0x1.bd49680000000p-107},
    {0x1.ed5c040000000p-70, NAN, NAN},
    {-0x1.12b9c20000000p+31, 0x1.6ca27c0000000p-75, -0x1.12b9c00000000p+31},
    {-0x1.2473fa0000000p-116, -0x1.33f9d40000000p-94, -0x1.2473fc0000000p-116},
    {0x1.dfbef60000000p-85, -0x1.ef93c00000000p+6, 0x1.dfbef40000000p-85},
    {-INFINITY, 0x1.c540a20000000p+57, -0x1.fffffe0000000p+127},
    {-0x1.230a2c0000000p+76, 0x1.8f4c520000000p+23, -0x1.230a2a0000000p+76},
    {0x1.fdc4da0000000p+81, -0x1.9b1ad60000000p+16, 0x1.fdc4d80000000p+81},
    {-0x1.446d500000000p-67, 0x1.4732d60000000p-15, -0x1.446d4e0000000p-67},
    {-0x1.fd74580000000p+23, 0x1.4a63d00000000p-52, -0x1.fd74560000000p+23},
    {-0x1.8c6cb80000000p+57, -0x1.214f820000000p+122, -0x1.8c6cba0000000p+57},
    {0x1.abff200000000p+124, -0x1.3fad020000000p+122, 0x1.abff1e0000000p+124},
    {0x1.1e39bc0000000p+48, 0x1.421d0e0000000p+111, 0x1.1e39be0000000p+48},
    {-0x1.ff090a0000000p+90, 0x1.6432c00000000p+100, -0x1.ff09080000000p+90},
    {-0x1.471f1c0000000p-67, 0x1.c870620000000p-69, -0x1.471f1a0000000p-67},
    {-0x1.c567ae0000000p-31, -0x1.2194bc0000000p-105, -0x1.c567ac0000000p-31},
    {0x1.2ab9a80000000p+98, 0x1.be88ee0000000p+99, 0x1.2ab9aa0000000p+98},
    {-0x1.27ff1c0000000p+15, 0x1.d9cd1c0000000p+90, -0x1.27ff1a0000000p+15},
    {-0x1.6689820000000p+104, -0x1.5cfca20000000p-10, -0x1.6689800000000p+104},
    {0x1.1c32400000000p+8, -0x1.e961520000000p+12, 0x1.1c323e0000000p+8},
    {0x1.6995ca0000000p-79, 0x1.917f840000000p-77, 0x1.6995cc0000000p-79},
    {0x1.8e7c1e0000000p+29, -0x1.50f9d80000000p+72, 0x1.8e7c1c0000000p+29},
    {0x1.db16160000000p-65, -0x1.ac74ac0000000p-50, 0x1.db16140000000p-65},
    {0x1.f3ec6c0000000p-122, 0x1.f79c500000000p+100, 0x1.f3ec6e0000000p-122},
    {-0x1.9bace80000000p+24, -0x1.3a1ef80000000p-72, -0x1.9bace60000000p+24},
    {0x1.f517dc0000000p+55, -0x1.8e32d00000000p-113, 0x1.f517da0000000p+55},
    {-0x1.a862880000000p-124, 0x1.43cea80000000p-70, -0x1.a862860000000p-124},
    {0x1.d805300000000p-43, -0x1.ba30820000000p+74, 0x1.d8052e0000000p-43},
    {0x1.59e14c0000000p-58, -0x1.a6c40c0000000p+115, 0x1.59e14a0000000p-58},
    {-0x1.a17f4a0000000p-58, 0x1.eddac20000000p-117, -0x1.a17f480000000p-58},
    {0x1.3afc4c0000000p+80, -0x1.df911e0000000p-47, 0x1.3afc4a0000000p+80},
    {0x1.7575920000000p+67, -0x1.9e2b300000000p-105, 0x1.7575900000000p+67},
    {0x1.95e2580000000p+61, 0x1.43a9da0000000p+96, 0x1.95e25a0000000p+61},
    {-0x1.d86d520000000p-113, -0x1.f0d5d40000000p-36, -0x1.d86d540000000p-113},
    {0x1.81eec80000000p-14, -0x1.d00d380000000p+80, 0x1.81eec60000000p-14},
    {-0x1.d12bf00000000p+36, -0x1.492cac0000000p-39, -0x1.d12bee0000000p+36},
};
const int num_testcases = sizeof(testcases)/sizeof(testcases[0]);

extern const testcase_t testcases[];
extern const int num_testcases;

int float_eq(float x, float y) {
    if (isnan(x) && isnan(y)) return 1;
    uint32_t ux, uy;
    memcpy(&ux, &x, sizeof(ux));
    memcpy(&uy, &y, sizeof(uy));
    return ux == uy;
}

int main(void) {
    printf("       a             b          expect        actual      expect_bits actual_bits\n");
    for (int i = 0; i < num_testcases; ++i) {
        float actual = nextafterf(testcases[i].a, testcases[i].b);
        uint32_t a_bits, expect_bits, actual_bits;
        memcpy(&a_bits,      &testcases[i].a,      sizeof(a_bits));
        memcpy(&expect_bits, &testcases[i].expect, sizeof(expect_bits));
        memcpy(&actual_bits, &actual,              sizeof(actual_bits));

        printf("%+12.8e %+12.8e %+12.8e %+12.8e 0x%08lx 0x%08lx\n",
            testcases[i].a, testcases[i].b, testcases[i].expect, actual,
            expect_bits, actual_bits);

        if (!float_eq(actual, testcases[i].expect)) {
            printf("Test %d failed: actual does not match expected value.\n", i);
            return i;
        }
    }
    printf("All tests passed!\n");
    return 0;
}

